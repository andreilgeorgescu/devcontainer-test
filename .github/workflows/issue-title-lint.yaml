name: Lint PR Title
on:
  pull_request:
    types:
      - opened
      - synchronize
      - reopened
      - edited

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - name: Check PR Title
        id: lint-title
        run: |
          python - <<EOF
          import re
          import os

          pattern = r'^PR-\d+'
          title = os.getenv("INPUT_PULL_REQUEST_TITLE")

          if not re.match(pattern, title):
              echo "Error: Pull request title must start with 'PR-' followed by a number." >&2
              echo "status=failure" >> $GITHUB_ENV
              exit(0) # Exit successfully to prevent the workflow from failing
          EOF
        env:
          INPUT_PULL_REQUEST_TITLE: ${{ github.event.pull_request.title }}

      - name: Set Status Check
        if: ${{ steps.lint-title.outputs.status == 'failure' }}
        uses: actions/github-script@v5
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const { context, github } = require('@actions/github');

            github.repos.createStatus({
              ...context.repo,
              sha: context.sha,
              state: 'failure',
              context: 'Lint PR Title',
              description: 'Pull request title does not match the required format.',
              target_url: '',
            });
